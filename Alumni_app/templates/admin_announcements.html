{% load static %}
<!DOCTYPE html>
<html>
<head>
    <title>Admin Announcements</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'admin.css' %}">
</head>
<body>

<div class="container">

    <!-- SIDEBAR -->
    <aside class="sidebar">
        <div class="profile-box">
            <img src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png" alt="admin">
            <h3>Admin Panel</h3>
        </div>

        <a href="{% url 'admin_portal' %}">Dashboard</a>
        <a href="{% url 'view_events_admin' %}">Events</a>
        <a href="{% url 'admin_view_alumni' %}">Alumni</a>
        <a href="{% url 'manage_jobs_admin' %}">Job</a>
        <a class="active" href="{% url 'admin_announcements' %}">Announcements</a>
        <a href="{% url 'logout' %}">Logout</a>
    </aside>

    <!-- MAIN -->
    <div class="main">

        <div class="navbar">
            Announcements
            <button type="button" class="btn" onclick="openModal('addModal')">
                Add Announcement
            </button>
        </div>

        <div class="content">
            <table>
                <tr>
                    <th>Title</th>
                    <th>Date</th>
                    <th>Actions</th>
                </tr>

                {% for a in announcements %}
                <tr>
                    <td>{{ a.title }}</td>
                    <td>{{ a.posted_on|date:"M d, Y" }}</td>
                    <td>
                        <div class="action-buttons">
                            <button type="button"
                                    class="btn-edit"
                                    onclick="openModal('editModal{{ a.id }}')">
                                Edit
                            </button>

                            <button type="button"
                                    class="btn-delete"
                                    onclick="openModal('deleteModal{{ a.id }}')">
                                Delete
                            </button>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </table>
        </div>
    </div>
</div>

<!-- ADD MODAL -->
<div id="addModal" class="modal">
    <div class="modal-box">
        <h3>Add Announcement</h3>

        <form method="POST" action="{% url 'add_announcement' %}" enctype="multipart/form-data">
            {% csrf_token %}

            <input type="text" name="title" placeholder="Title" required>

            <textarea name="message" placeholder="Message" required></textarea>

            <!-- File upload -->
            <input type="file" name="image" accept="image/*">

            <!-- Buttons -->
            <div class="modal-actions">
                <button type="submit" class="btn btn-save">Save</button>
                <button type="button" class="btn btn-cancel" onclick="closeModal('addModal')">
                    Cancel
                </button>
            </div>
        </form>
    </div>
</div>

<!-- EDIT + DELETE MODALS -->
{% for a in announcements %}

<!-- EDIT MODAL -->
<div id="editModal{{ a.id }}" class="modal">
    <div class="modal-box">
        <h3>Edit Announcement</h3>

        <form method="POST" action="{% url 'edit_announcement' a.id %}">
            {% csrf_token %}
            <input type="text" name="title" value="{{ a.title }}" required>
            <textarea name="message" required>{{ a.message }}</textarea>
            <input type="text" name="image_url" value="{{ a.image_url }}" placeholder="Image URL">
            <button type="submit" class="btn-primary">Update</button>
        </form>

        <div class="modal-actions">
            <button type="button"
                    class="btn-secondary"
                    onclick="closeModal('editModal{{ a.id }}')">
                Cancel
            </button>
        </div>
    </div>
</div>

<!-- DELETE MODAL -->
<div id="deleteModal{{ a.id }}" class="modal">
    <div class="modal-box">
        <h3>Delete Announcement?</h3>
        <p>Are you sure you want to delete this announcement?</p>

        <form method="POST" action="{% url 'delete_announcement' a.id %}">
            {% csrf_token %}
            <div class="modal-footer">
                <button type="button"
                        class="btn-cancel"
                        onclick="closeModal('deleteModal{{ a.id }}')">
                    Cancel
                </button>

                <button type="submit"
                        class="btn-danger">
                    Delete
                </button>
            </div>
        </form>
    </div>
</div>


{% endfor %}

<!-- MODAL SCRIPT -->
<script>
function openModal(id) {
    document.querySelectorAll('.modal').forEach(modal => {
        modal.style.display = "none";
    });
    document.getElementById(id).style.display = "flex";
}

function closeModal(id) {
    document.getElementById(id).style.display = "none";
}
</script>

</body>
</html>
